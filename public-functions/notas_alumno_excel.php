<?php//session_start();//print_r($_SESSION["user_data"]);$id = $_GET["id"];include '../includes/general_settings.php';$alumno = new people();$profile_data = $alumno->get_info_by_id($id);header("Content-Type: application/vnd.ms-excel; charset=UTF-8");header('Content-Disposition: attachment; filename=notas_' . $profile_data["full_name"] . "_" . get_simple_date() . '.xls');header("Expires: 0");header("Cache-Control: must-revalidate, post-check=0, pre-check=0");header("Cache-Control: private", false);$notas_alumnos = new notas_alumnos();$notas_alumnos_data = $notas_alumnos->get_notas_by_alumno($id);$data_notas_details = $notas_alumnos->get_notas_details_by_aula($id);$data_notas = array();$anterior = 0;$out_notas = '';if (is_array($notas_alumnos_data) && (count($notas_alumnos_data) > 0)) {    $out_notas = "";    $notas_ordenadas = array();    $e = 0;    foreach ($notas_alumnos_data as $v) {        $notas_ordenadas[$v['fk_modulo']][$e] = $v;        $e++;    }//        print_r($notas_ordenadas);    foreach ($notas_ordenadas as $v) {        $notas_list = "";        if (count($v) > 0) {//                print_r($v);            foreach ($v as $vv) {                $notas_list .= '<tr>';                $notas_list .= '<td style="border:1px solid #ccc">' . $vv['title_aulas_notas'] . '</td>';                $notas_list .= '<td style="border:1px solid #ccc"> ' . $vv['nota_alumno'] . '</td>';                $notas_list .= '<td style="border:1px solid #ccc">' . $vv['comentario'] . '</td>';                $notas_list .= '</tr>';            }        }        $out_notas .= '<tr> <th style="background:#ccc; text-align:left;" colspan="3">' . $vv["nombre_modulo"] . '</th> </tr> ' . $notas_list;    }}$notas_list = '';$list_notas_prev = '';if (is_array($data_notas)) {    $salida = '<tr><th>Nota</th>';    for ($e = 0; $e < count($data_notas_details); $e++) {        $salida .= "<th>" . $data_notas_details[$e]["title_aulas_notas"] . "</th>";    }    $salida .= '</tr>';    foreach ($data_notas as $k => $v) {        $list_notas_prev = '';        if (is_array($v["notas"])) {            foreach ($data_notas_details as $val) {                $list_notas_prev .= '<td data-original-title="' . $v["notas"][$val["id_aulas_notas"]]["commment"] . '">' . $v["notas"][$val["id_aulas_notas"]]["nota"] . '</td>';            }        }        $notas_list .= '<tr>                                <td>' . $v["name"] . '<span style="display:block;font-weight:bold">' . $v["email"] . '</span></td>                                ' . $list_notas_prev . '                            </tr>';    }}echo '<html lang="es">    <head>        <meta charset="utf-8">        <meta http-equiv="X-UA-Compatible" content="IE=edge">        <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1, maximum-scale=1">    </head>    <style>        table{            border-collapse: collapse;        }           table * {            border: 1px solid #ccc;            padding:5px;        }    </style>    <body><table>' . '<tr>' . '<th colspan="3">' . $profile_data["full_name"] . '</th>' . '</tr>' . '<tr>' . '<th style="width:30%;">Nombre</th>                                        <th style="width:10%;">Nota</th>                                        <th>comentario</th>' . '</tr>' . $out_notas . '</table>' . '</body></html>';