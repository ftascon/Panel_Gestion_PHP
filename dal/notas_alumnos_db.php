<?phpclass notas_alumnos extends Database {    function get_alumnos_by_nota($id_nota, $id_aula) {        $stmt = "select                             people.id_people,                            people.fname_people,                             people.lname1_people,                             people.lname2_people,                             people.email_people,                            people.photo_people,                            notas_alumnos.fk_nota,                            notas_alumnos.nota_alumno,                            notas_alumnos.comentario                    from notas_alumnos                     left join people ON people.id_people = notas_alumnos.fk_alumno                     where notas_alumnos.fk_nota = '" . $id_nota . "' "                . "group by people.id_people";//        echo $stmt;        $result = $this->mysqli->query($stmt);        while ($row = $result->fetch_assoc()) {            $output[$row["id_people"]] = $row;        }        $this->mysqli->free_result;        return $output;    }    function save_notas($data, $id_nota) {//      print_r($data);        foreach ($data as $key => $value) {            $stmt_count = "SELECT COUNT(id_notas_alumnos) as num, id_notas_alumnos as id "                    . "FROM notas_alumnos "                    . "WHERE fk_nota = " . $id_nota . " AND "                    . "fk_alumno = " . $key;//            echo $stmt_count;            $res = $this->getRecord($stmt_count);            if ($res[0]["num"] > 0) {                $stmt = "UPDATE notas_alumnos SET ";                foreach ($data[$key] as $subkey => $subvalue) {                    $this->mysqli->escape_string($subvalue);                    $stmt_values .= ", " . $subkey . " = '" . $subvalue . "'";                }                $stmt_values = trim($stmt_values, ",");                $stmt .= $stmt_values . " WHERE id_notas_alumnos = '" . $res[0]["id"] . "';";            } else {                $stmt = "INSERT INTO notas_alumnos (fk_nota, fk_alumno";                $stmt_values = "(" . $id_nota . "," . $key;                foreach ($data[$key] as $subkey => $subvalue) {                    if (is_null($data[$key][$subkey]) || empty($data[$key][$subkey])) {                                            } else {                        $this->mysqli->escape_string($subvalue);                        $stmt .= "," . $subkey;                        $stmt_values .= ",'" . $subvalue . "'";                    }                }                $stmt .= ") VALUES " . $stmt_values . ");";            }            $this->mysqli->query($stmt);        }        return true;    }    function save_single_nota($data, $id_nota) {        /* $data debe contener          * $data["id_people"] = fk_alumno;         * $data["nota"] = nota_alumno;         * $data["comentario"] = comentario;         */        $stmt_chk = 'SELECT * FROM notas_alumnos WHERE fk_nota = ' . $id_nota . ' AND fk_alumno = ' . $data["id_people"] . '';        $existente = $this->getRecord($stmt_chk);        if (!array_key_exists("comentario", $data)) {            $data["comentario"] = "";        }        if (count($existente) > 0) {            $stmt = 'UPDATE notas_alumnos '                    . 'SET nota_alumno = ' . $data["nota"] . ', '                    . 'comentario = "' . $data["comentario"] . '" '                    . 'WHERE fk_nota = ' . $id_nota . ' '                    . 'AND fk_alumno = ' . $data["id_people"];        } else {            $stmt = 'INSERT INTO notas_alumnos (fk_alumno,fk_nota,nota_alumno,comentario) '                    . 'VALUES (' . $data["id_people"] . ',' . $id_nota . ',' . $data["nota"] . ',"' . $data["comentario"] . '")';        }        $this->mysqli->query($stmt);    }    function get_notas_by_alumno($id) {        $stmt = "SELECT                        aulas_ediciones.fk_edicion,                        ediciones.*, servicios.name_servicio,                        notas_alumnos.id_notas_alumnos,                        notas_alumnos.fk_alumno,                        notas_alumnos.fk_nota,                        notas_alumnos.nota_alumno,                        notas_alumnos.comentario,                        aulas_notas.id_aulas_notas,                        aulas_notas.title_aulas_notas,                        aulas.nombre_aula,                        aulas.id_aula,                        aulas.fk_modulo,                        aulas.f_inicio,                        aulas.url_aula,                        modulos.nombre_modulo                FROM                        notas_alumnos                JOIN aulas_notas ON aulas_notas.id_aulas_notas = notas_alumnos.fk_nota                JOIN aulas ON aulas.id_aula = aulas_notas.fk_aula                LEFT JOIN aulas_ediciones ON aulas_ediciones.fk_aula = aulas.id_aula                LEFT JOIN ediciones ON ediciones.id_ediciones = aulas_ediciones.fk_edicion                LEFT JOIN servicios ON servicios.id_servicio = ediciones.fk_servicio                JOIN modulos ON modulos.id_modulo = aulas.fk_modulo                WHERE notas_alumnos.fk_alumno = '" . $id . "'                GROUP BY fk_nota";        return $this->getRecord($stmt);    }    function get_notas_by_aula($id, $aula) {        $stmt = "SELECT                    aulas_notas.id_aulas_notas,                    aulas_notas.title_aulas_notas,                    aulas_notas.fk_aula,                    notas_alumnos.nota_alumno,                    notas_alumnos.comentario                FROM aulas_notas                LEFT JOIN notas_alumnos ON notas_alumnos.fk_nota=  aulas_notas.id_aulas_notas                WHERE aulas_notas.fk_aula = '" . $aula . "' "                . "AND notas_alumnos.fk_alumno = '" . $id . "'";        return $this->getRecord($stmt);    }    function get_notas_details_by_aula($id) {        $stmt = "SELECT                a.id_aula,                an.title_aulas_notas,                an.id_aulas_notas,                an.coment_aulas_notas                FROM aulas a                LEFT JOIN aulas_notas an ON a.id_aula = an.fk_aula                WHERE a.id_aula = '" . $id . "'";        return $this->getRecord($stmt);    }    function get_all_notas_by_aula($id) {        $stmt = 'SELECT	people.id_people,	people.lname1_people,	people.lname2_people,	people.fname_people,	people.email_people,	servicios.name_servicio,	aulas_notas.id_aulas_notas,	aulas_notas.title_aulas_notas,	notas_alumnos.id_notas_alumnos,	notas_alumnos.nota_alumno,	notas_alumnos.comentarioFROM	people peopleLEFT JOIN alumnos_servicios ON alumnos_servicios.id_alumnos_servicios = people.id_peopleLEFT JOIN servicios ON alumnos_servicios.fk_servicio = servicios.id_servicioLEFT JOIN aulas_alumnos ON aulas_alumnos.fk_alumno = people.id_peopleLEFT JOIN aulas_notas ON aulas_notas.fk_aula = aulas_alumnos.fk_aulaLEFT JOIN notas_alumnos ON (notas_alumnos.fk_alumno = people.id_people) AND (notas_alumnos.fk_nota = aulas_notas.id_aulas_notas)WHERE	fk_type_people = "1"AND aulas_alumnos.fk_aula = "' . $id . '"AND notas_alumnos.id_notas_alumnos > 0GROUP BY	notas_alumnos.id_notas_alumnosORDER BY	people.email_people ASC';        return $this->getRecord($stmt);    }}